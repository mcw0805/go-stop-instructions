<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title></title>

    <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js" integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js" integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9" crossorigin="anonymous"></script>
    <script>$(document).ready(function() { $('body').bootstrapMaterialDesign(); });</script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css" integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX" crossorigin="anonymous"> -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <!-- <script src="./gameBoardGraphics.js"></script> -->

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" href="css/styles.css">

    <!-- fonts -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">



</head>

<body>
    <header>
        Header

    </header>

    <div class="container">

        <div class="card">
            <h4 class="card-title">Game Setup</h4>

            <div class="card-body" id="parent1">
                <p>
                    The players sit in a circle or in some round fashion. The play begins with the dealer distributing
                    the cards.
                </p>

                <p>
                    The game set up is broken into two main parts:
                </p>


                <div class="accordion" id="setupStepsAccordion">
                    
                    <!-- select dealer card -->
                    <div class="card">
                        <div class="card-header" id="selectDealerHeader">
                            <h5 class="mb-0">
                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#selectDealerCollapse" aria-expanded="false" aria-controls="selectDealerCollapse">
                                  A. Selecting the Dealer
                                </button>
                            </h5>
                        </div>

                        <div id="selectDealerCollapse" class="collapse false" aria-labelledby="selectDealerHeader" data-parent="#setupStepsAccordion">
                            <div class="card-body">
                                <p>The dealer is selected by a method called <span class="foreign-word">bam-il-nat-jang (밤일낮장)</span>. Translating each syllable becomes <i>night-one-day-big.</i></p>

                                <p>
                                    Steps:
                                    <ol>
                                        <li>Each player selects a random card from the deck.</li>
                                        <li>Check the time of the day.</li>
                                        <ul>
                                            <li>
                                                Night time: Player with the month card closest to January is the dealer.  
                                            </li>
                                            <li>
                                                Day time: Player with the month card closest to December is the dealer.  
                                            </li>
                                        </ul>
                                    </ol>

                                    <p>Does the translation make sense now?</p>

                                </p>
                                
                            </div>
                        </div>
                    </div>

                    <!-- select shuffle/cut/deal card -->
                    <div class="card">
                        <div class="card-header" id="cardHandoutHeader">
                            <h5 class="mb-0">
                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#cardHandoutCollapse" aria-expanded="false" aria-controls="cardHandoutCollapse">
                                 B. Distributing Out Cards
                                </button>
                            </h5>
                        </div>

                        <div id="cardHandoutCollapse" class="collapse false" aria-labelledby="cardHandoutHeader" data-parent="#setupStepsAccordion">
                            <div class="card-body">

                                <h6 class="card-subtitle">Shuffling</h6>
                                <p>The dealer is responsible for sufficiently shuffling the deck before dealing the cards to the players.</p>

                                <h6 class="card-subtitle">Cutting</h6>
                                <p>
                                    The last player in the circle (i.e. the player immediately left of the dealer) is responsible for cutting the deck.
                                </p> 
                                <p>
                                    This player will grab a chunk of the deck from the dealer's hand and place it face down on the center of the game floor.
                                </p>

                                <h6 class="card-subtitle">Dealing</h6>

                                <p>The dealer takes the following steps for handing out the card.</p>
                                <p>
                                    
                                    Two Players:
                                    <ol>
                                        <li>Place 4 cards facing up on the floor.</li>
                                        <li>Hand 5 cards facing down to the other player.</li>
                                        <li>Hand 5 cards to their hand.</li>
                                        <li>Repeat 1-3 once more.</li>
                                        <li>Place the remaining deck in the center of the floor.</li>
                                    </ol>

                                </p>

                                <p>
                                    
                                    Three Players:
                                    <ol>
                                        <li>Place 3 cards facing up on the floor.</li>
                                        <li>Hand 4 cards to the other player’s hand facing down, starting with the player right of the dealer and moving in counterclockwise direction</li>
                                        <li>Hand 4 cards to their hand.</li>
                                        <li>Repeat 1-3 once more.</li>
                                        <li>Place the remaining deck on the center of the floor.</li>
                                    </ol>

                                </p>

                                <div class="svg-container" id="floorPlan" style="position: relative; width: 100%;"></div>


                            </div>
                        </div>

                    </div>
                
                </div> <!-- end accordion -->

                <hr>

                <p>
                    
                </p>
                <div style="display:none;">
                  <img id="source"
                       src="./assets/_back.svg"
                       >
                </div>


            </div>
        </div>

    </div>
    <script type="text/javascript" src="./gameBoardGraphics.js"></script>

    <script type="text/javascript">
    $(document).ready(function() {

        let body = d3.select('body');
        let floorPlan = body.select('#floorPlan');
        let svgContainer = createSvgElement(body, 'floorPlan');

       addAllCardsAsPattern();

        drawFloorSections(svgContainer, floorPlan);
        $('#cardHandoutCollapse').on('shown.bs.collapse', () => {
            drawCenterRemainingDeck(svgContainer);
            initialFloorSetUp();
        });
        

        function initialFloorSetUp() {
            // opponent card
            drawHandCardFaceDownSvg(svgContainer)

            // curr player hand card
            drawHandCardForCurrPlayer(svgContainer, '_1_1', position=0) 
            drawHandCardForCurrPlayer(svgContainer, '_2_3', position=1) 
            drawHandCardForCurrPlayer(svgContainer, '_4_1', position=2) 
            drawHandCardForCurrPlayer(svgContainer, '_4_2', position=3) 
            drawHandCardForCurrPlayer(svgContainer, '_6_1', position=4) 
            drawHandCardForCurrPlayer(svgContainer, '_6_3', position=5) 
            drawHandCardForCurrPlayer(svgContainer, '_7_2', position=6)
            drawHandCardForCurrPlayer(svgContainer, '_8_3', position=7)
            drawHandCardForCurrPlayer(svgContainer, '_10_1', position=8)
            drawHandCardForCurrPlayer(svgContainer, '_12_3', position=9)
            

            // floor cards
            drawFloorCard(svgContainer, '_2_2', floorPos=1);
            drawFloorCard(svgContainer, '_5_3', floorPos=2);
            drawFloorCard(svgContainer, '_6_2', floorPos=3);
            drawFloorCard(svgContainer, '_11_2', floorPos=4);
            drawFloorCard(svgContainer, '_9_1', floorPos=5, cardPosWithin=0);
            drawFloorCard(svgContainer, '_9_2', floorPos=5, cardPosWithin=1);
            drawFloorCard(svgContainer, '_7_3', floorPos=6, cardPosWithin=0);
            drawFloorCard(svgContainer, '_7_4', floorPos=6, cardPosWithin=1);
            //drawFloorCard(svgContainer, '_10_4', floorPos=4), cardPosWithin=1;

            
        }


    });
    </script>
    

</body>
<!-- <script type="text/javascript">
    $(document).ready(function() {
        var canvas = document.getElementById('floorCanvas');
        let aspectRatio = 0.9;
        let imageScale = 6;

        let backCardImgSrc = './assets/_back.svg';
        let deckImg = new Image();
        deckImg.src = backCardImgSrc;
        console.log(deckImg.width / imageScale);
        console.log(deckImg.height / imageScale);
        // let gridUnitHeight = deckImg.height / imageScale + 2 * (deckImg.height / (imageScale * 2));
        // let gridUnitWidth = deckImg.width / imageScale + 2 * (deckImg.width / 4);
        // console.log(gridUnitHeight);
        // console.log(gridUnitWidth);

        // padding division scale
        let gridWidthPaddingScale = 4;
        let gridHeightPaddingScale = 6;

        // padding for grid
        let gridLeftRightPadding = (deckImg.width / imageScale) / gridWidthPaddingScale;
        let gridTopBottomPadding = (deckImg.height / imageScale) / gridHeightPaddingScale;

        // actual grid unit
        let gridUnitHeight = deckImg.height / imageScale + 2 * gridTopBottomPadding;
        let gridUnitWidth = deckImg.width / imageScale + 2 * gridLeftRightPadding;

        
        // heights
        let handCardSectionHeight = gridUnitHeight;
        let collectionCardSectionHeight = gridUnitHeight * 2 - 2 * gridTopBottomPadding;
        let mainGameFloorSectionHeight = gridUnitHeight * 4;

        // y pos
        let opponentHandCardSectionPos = 0;
        let opponentCollectionSectionPos = gridUnitHeight;
        let mainGameFloorSectionPos = opponentCollectionSectionPos + collectionCardSectionHeight;
        let playerCollectionSectionPos = mainGameFloorSectionPos + mainGameFloorSectionHeight;
        let playerHandSectionPos = playerCollectionSectionPos + collectionCardSectionHeight;

        // yPos, height
        let sections = {
            0: [opponentHandCardSectionPos, handCardSectionHeight],
            1: [opponentCollectionSectionPos, collectionCardSectionHeight],
            2: [mainGameFloorSectionPos, mainGameFloorSectionHeight],
            3: [playerCollectionSectionPos, collectionCardSectionHeight],
            4: [playerHandSectionPos, handCardSectionHeight]
        };

        let colors = ['#00CC00', '#009900', 'green', 'blue', 'green'];
        colors = ['green', '#009900', '#00CC00', 'blue', 'green'];


        if (canvas.getContext) {
            var ctx = canvas.getContext('2d');

            // https://stackoverflow.com/questions/34772957/how-to-make-canvas-responsive
            // canvas.height = handCardSectionHeight * 2 + collectionCardSectionHeight * 2 + mainGameFloorSectionHeight;//canvas.width * aspectRatio;
            // console.log('width ' + canvas.width);
            // console.log('height ' + canvas.height);
            // console.log('ratio '+ canvas.width / canvas.height);

            // ctx.fillStyle = 'green';
            // ctx.fillRect(0, 0, canvas.width, gridUnitHeight);
            // ctx.fillStyle = 'blue';
            // ctx.fillRect(0, gridUnitHeight, gridUnitWidth, gridUnitHeight * 2 - 2 * gridTopBottomPadding);
            // ctx.fillStyle = 'orange';
            // ctx.fillRect(0, gridUnitHeight + gridUnitHeight * 2 - 2 * gridTopBottomPadding, canvas.width, gridUnitHeight * 4);

            // for (let i = 0; i < 5; i++) {
            //     ctx.fillStyle = colors[i];
            //     ctx.fillRect(0, sections[i][0], canvas.width, sections[i][1]);
            // }

            // //ctx.fillRect(0, 0, canvas.width, canvas.height);


            // let currCenterX = canvas.width / 2;
            // let currCenterY = canvas.height / 2;
            // const image = document.getElementById('source');
            // // ctx.drawImage(image, currCenterX - image.width / imageScale / 2, currCenterY - image.height / imageScale / 2, image.width / imageScale, image.height / imageScale);

            // ctx.drawImage(deckImg, currCenterX - deckImg.width / imageScale / 2, currCenterY - deckImg.height / imageScale / 2, deckImg.width / imageScale, deckImg.height / imageScale);
            // console.log(canvas.height);
            // drawHandCardFaceDown();

        }

        function drawHandCardFaceDown(startPosX=gridLeftRightPadding, startPosY=gridTopBottomPadding, numCards=10) {
            for (let i = 0; i < numCards; i++) {
                ctx.drawImage(deckImg, 
                            startPosX + i * (deckImg.width / imageScale + gridLeftRightPadding),
                            startPosY,
                            deckImg.width / imageScale,
                            deckImg.height / imageScale);
            }
        }


        let body = d3.select('body');
        let floorPlan = body.select('#floorPlan');
        // let svgContainer = floorPlan.append('svg')
        //                     .attr('xmlns', 'http://www.w3.org/2000/svg')
        //                     .attr('width', '100%')
        //                     .attr('viewBox', '0 0 300 316')
        //                     .attr('preserveAspectRatio',"none" )
                             // .attr('height', handCardSectionHeight * 2 + collectionCardSectionHeight * 2 + mainGameFloorSectionHeight);
        let svgContainer = createSvgElement('floorPlan');
        
        drawSections(svgContainer);
        centerDeck(svgContainer);
        function createSvgElement(divId) {
            let divFloor = body.select(`#${divId}`);
            let newSvgElement = divFloor.append('svg')
                                        .attr('xmlns', 'http://www.w3.org/2000/svg')
                                        .attr('width', '100%')
                                        .attr('viewBox', '0 0 300 316')
                                        .attr('preserveAspectRatio','none' );
            
            newSvgElement.append('defs');
    
            return newSvgElement;
        }

        function drawSections(svgEl) {
            for (let i = 0; i < 5; i++) {
                svgEl.append('rect')
                        .attr('id', 'board_' + i)
                        .attr('x', 0)
                        .attr('y', sections[i][0])
                        .attr('width', floorPlan.style('width'))
                        .attr('height', sections[i][1])
                        .attr('fill', colors[i]);
            }
        }

        console.log(d3.select('svg').node().getBBox().height)
        console.log(svgContainer)
        console.log(body.select('svg').node().getBBox().width)
        console.log(d3.select('#board_2').node().getBBox().width)
        console.log($('#floorPlan svg').width());

        //$('#selectDealerCollapse').on('shown.bs.collapse',centerDeck);
        $('#selectDealerCollapse').on('shown.bs.collapse', () => {
            centerDeck(svgContainer);
        });

        function centerDeck(svgEl) {
            // center deck
            svgEl.append('svg:image')
                        .attr('xlink:href', backCardImgSrc)
                        .attr('x', svgEl.node().getBBox().width / 2 - deckImg.width / imageScale / 2)
                        .attr('y', svgEl.node().getBBox().height / 2 - deckImg.height / imageScale / 2)
                        .attr('width', deckImg.width / imageScale)
                        .attr('height', deckImg.height / imageScale);
        
            }

        drawHandCardFaceDownSvg();
        drawHandCardFaceUpSvg();
        placeCardOnCollector(0, './assets/converted/_1_1.svg', 0);
        placeCardOnCollector(0, './assets/converted/_3_1.svg', 1);
        placeCardOnCollector(0, './assets/converted/_8_1.svg', 2);
        placeCardOnCollector(0, './assets/converted/_11_1.svg', 3);
        placeCardOnCollector(0, './assets/converted/_12_1.svg', 4, true);

        placeCardOnCollector(1, './assets/converted/_2_1.svg', 0);
        placeCardOnCollector(1, './assets/converted/_4_1.svg', 1, true);

        placeCardOnCollector(2, './assets/converted/_2_2.svg', 0);
        placeCardOnCollector(2, './assets/converted/_4_2.svg', 1, true);

        //placeCardOnCollector(3, './assets/converted/_4_3.svg', 0, false, "x");
        placeCardOnCollector(3, './assets/converted/_4_4.svg', 1, true);

        function drawHandCardFaceDownSvg(startPosX=gridLeftRightPadding, startPosY=gridTopBottomPadding, numCards=10) {
            for (let i = 0; i < numCards; i++) {
                svgContainer.append('svg:image')
                            .attr('xlink:href', backCardImgSrc)
                            .attr('x', startPosX + i * (deckImg.width / imageScale + gridLeftRightPadding))
                            .attr('y', startPosY)
                            .attr('width', deckImg.width / imageScale)
                            .attr('height', deckImg.height / imageScale);
            }
        }

        function drawHandCardFaceUpSvg(startPosX=gridLeftRightPadding, startPosY=(handCardSectionHeight + collectionCardSectionHeight*2 + mainGameFloorSectionHeight + gridTopBottomPadding), numCards=10) {
            for (let i = 0; i < numCards; i++) {
                svgContainer.append('svg:image')
                            .attr('xlink:href', backCardImgSrc)
                            .attr('x', startPosX + i * (deckImg.width / imageScale + gridLeftRightPadding))
                            .attr('y', startPosY)
                            .attr('width', deckImg.width / imageScale)
                            .attr('height', deckImg.height / imageScale);
            }
        }

        function placeCardOnCollector(rank, imgSrc='./assets/_back.svg', cardPosWithin=0, currPlayer=false, id="", startPosX=gridLeftRightPadding, startPosY=(handCardSectionHeight +  deckImg.height / imageScale / 2 + gridTopBottomPadding)) {
            

            if (rank == 0) {
                startPosX = gridLeftRightPadding;
                startPosY = handCardSectionHeight +  deckImg.height / imageScale / 2 + gridTopBottomPadding;
                
            } else if (rank == 1) {
                startPosX = 5 * deckImg.width / imageScale / 2 + 2.5 * gridUnitWidth + gridLeftRightPadding;
                startPosY = handCardSectionHeight + gridTopBottomPadding;
                
            } else if (rank == 2) {
                startPosX = 5 * deckImg.width / imageScale / 2 + 2.5 * gridUnitWidth + gridLeftRightPadding;
                startPosY = handCardSectionHeight + deckImg.height / imageScale + gridTopBottomPadding ;
            } else if (rank == 3) {
                startPosX = 5 * deckImg.width / imageScale / 2 + 6.5 * gridUnitWidth ;
                startPosY = handCardSectionHeight + deckImg.height / imageScale + gridTopBottomPadding ;
            }

            if (currPlayer) {
                    //if (rank == 1) {
                        startPosY += (collectionCardSectionHeight + mainGameFloorSectionHeight);
                        // handCardSectionHeight + collectionCardSectionHeight + mainGameFloorSectionHeight + deckImg.height / imageScale / 2 + gridTopBottomPadding;
                    // } else {

                    // }

            }


            svgContainer.append('svg:image')
                            .attr('xlink:href', imgSrc)
                            .attr('x', startPosX + cardPosWithin * deckImg.width / imageScale / 2)
                            .attr('y', startPosY)
                            .attr('width', deckImg.width / imageScale)
                            .attr('height', deckImg.height / imageScale);

        }



        let g1 = svgContainer.append('g').attr('id', 'g1')
                            .append('svg:image')
                            .attr('id', 'img1')
                            .attr('xlink:href', './assets/converted/_12_4.svg')
                            .attr('x', 5 * deckImg.width / imageScale / 2 + 6.5 * gridUnitWidth  + 0 * deckImg.width / imageScale / 2)
                            .attr('y', handCardSectionHeight + deckImg.height / imageScale + gridTopBottomPadding)
                            .attr('width', deckImg.width / imageScale)
                            .attr('height', deckImg.height / imageScale)
    
        
        let imgPattern = svgContainer.append('defs')
                                    .append('pattern')
                                    .attr('id', 'pat1')
                                    //.attr('x', 0)
                                    //.attr('y', 0)
                                    //.attr('patternUnits', 'userSpaceOnUse')
                                    .attr('width', deckImg.width / imageScale)
                                    .attr('height', deckImg.height / imageScale)
                                    .append('svg:image')
                                    .attr('xlink:href', './assets/converted/_7_4.svg')
                                    .attr('width', deckImg.width / imageScale)
                                    .attr('height', deckImg.height / imageScale)
    
        // d3.select('#pat1').append('path')
        //         .attr('d', `m${deckImg.width/imageScale/2 - gridLeftRightPadding} 0 L${deckImg.width/imageScale/2 + gridLeftRightPadding} 0 L${deckImg.width/imageScale/2} ${gridTopBottomPadding} z`)
        //         .style('fill', 'magenta');

        let g2 = svgContainer.append('g').attr('id', 'g2')
                                g2.append('rect')
                                .attr('id', 'imgRect')
                                .attr('class', 'blinkRect')
                                .attr('x', 5 * deckImg.width / imageScale / 2 + 6.5 * gridUnitWidth  + 1 * deckImg.width / imageScale / 2)
                                .attr('y', handCardSectionHeight + deckImg.height / imageScale + gridTopBottomPadding)
                                .attr('width', deckImg.width / imageScale)
                                .attr('height', deckImg.height / imageScale)
                                .style('fill', 'url(#pat1)') 
                                .style('stroke', 'lime')
                                //.transition()
                                //.on('start', blink);         

        
        function blink() {
            let thisEl = d3.select(this);
            thisEl.transition()
                    .duration(1500)
                    .style('stroke', 'yellow')
                    .transition()
                    .duration(1500)
                    .style('stroke', 'none')
                    .on('end', blink)
        }

        let g3 = svgContainer.append('g').attr('id', 'g3')
                                g2.append('rect')
                                .attr('x', 5 * deckImg.width / imageScale / 2 + 6.5 * gridUnitWidth  + 1 * deckImg.width / imageScale / 2)
                                .attr('y', handCardSectionHeight + deckImg.height / imageScale + gridTopBottomPadding)
                                .attr('width', deckImg.width / imageScale)
                                .attr('height', deckImg.height / imageScale)
                                .style('fill', 'url(#pat1)') 
                                .style('stroke', 'lime')


        d3.select('#translateBtn').on('click', () => {
            g1.transition()
            //.attr('x', 5 * deckImg.width / imageScale / 2 + 6.5 * gridUnitWidth  + 0 * deckImg.width / imageScale / 2)
            .attr('y', handCardSectionHeight + deckImg.height / imageScale + gridTopBottomPadding + collectionCardSectionHeight + mainGameFloorSectionHeight);
        });


    });
    // var canvas = document.getElementById('floorCanvas');
    // if (canvas.getContext) {
    //     var ctx = canvas.getContext('2d');



    //     ctx.fillStyle = 'green';
    //     ctx.fillRect(0, 0, 500, 500);


    // }

    // function fitToContainer(canvas){
    //     canvas.style.width='100%';
    //     canvas.style.height='100%';
    //     canvas.width  = canvas.offsetWidth;
    //     canvas.height = canvas.offsetHeight;
    // }


    // function drawBoard() {

    // }
</script> -->


</html>